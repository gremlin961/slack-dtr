from flask import Flask, render_template, request
import datetime
from tinydb import TinyDB, Query, where
import json

tmpurl = 'https://your.slack.url/token'
db = TinyDB('/database/db.json')
searchdata = Query()

if len(db) == 0:
  db.insert({'id':1, 'slackurl':tmpurl})

app = Flask(__name__)

@app.route('/', methods=['GET', 'POST'])
def print_form():
    if request.method == 'POST':
        #return render_template('template.html', date_time=datetime.datetime.now(), slack_url=request.form['slack_url'])
        urlupdate=request.form['slack_url']
        db.update({'slackurl':urlupdate}, where('id') == 1)
        slackdbdata = db.search(searchdata.id == 1)
        slack_url = json.dumps(slackdbdata[0]["slackurl"]).strip('"')
        return render_template('template.html', date_time=datetime.datetime.now(), slack_url=slack_url)
    if request.method == 'GET':
        slackdbdata = db.search(searchdata.id == 1)
        slack_url = json.dumps(slackdbdata[0]["slackurl"]).strip('"')
        return render_template('template.html', date_time=datetime.datetime.now(), slack_url=slack_url)
        #return render_template('form.html')

if __name__ == '__main__':
    app.run(debug=True)
